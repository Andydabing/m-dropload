(function(){"use strict";var t,e,o,n=this,s="ontouchstart"in n,i=s?"touchstart":"mousedown",c=s?"touchend":"mouseup",a=s?"touchmove":"mousemove",r=s?"orientationchange":"resize",u=s?"touchcancel":"mouseup",d=document,l=function(){var t=0,e=0;return d.body&&(t=d.body.scrollTop),d.documentElement&&(e=d.documentElement.scrollTop),t-e>0?t:e},h=function(){var t=0,e=0;return document.body&&(t=document.body.scrollHeight),document.documentElement&&(e=document.documentElement.scrollHeight),t-e>0?t:e},m=function(){var t=0;return t="CSS1Compat"===document.compatMode?document.documentElement.clientHeight:document.body.clientHeight},p={prefix:function(){var t=window.getComputedStyle(document.documentElement,""),e=(Array.prototype.slice.call(t).join("").match(/-(moz|webkit|ms)-/)||""===t.OLink&&["","o"])[1],o="WebKit|Moz|MS|O".match(new RegExp("("+e+")","i"))[1];return{dom:o,lowercase:e,css:"-"+e+"-",js:e[0].toUpperCase()+e.substr(1)}}(),css:function(t,e,o,n){t.style[(n?"":p.prefix.css)+e]=o},mouseXY:function(t){var e,o;return t.originalEvent&&t.originalEvent.changedTouches?(e=t.originalEvent.changedTouches[0].pageX,o=t.originalEvent.changedTouches[0].pageY):t.changedTouches?(e=t.changedTouches[0].pageX,o=t.changedTouches[0].pageY):(e=t.pageX,o=t.pageY),{x:e,y:o}},insertAfter:function(t,e){var o=t.parentNode;o.lastChild==t?o.appendChild(e):o.insertBefore(e,t.nextSibling)}},f=function(){!this.isLock&&this.status.loading&&(this.status.loading=!1,this.obj.css("transform","translate3d(0,0,0)"),this.upObj.innerHTML=this.opt.up.template.success)};o=function(s,d){var g=null;t=n.document,e=t.body,g=void 0==s?e:s,this.opt=d,this.opt.windowHeight=window.innerHeight/5,this.obj=g,this.obj.css=function(t,e){return 2!==arguments.length?this.style[t]:void p.css(this,t,e)};var v=this;return g.addEventListener(i,function(t){o.start.call(v,t)}),g.addEventListener(c,function(t){o.end.call(v,t)}),g.addEventListener(a,function(t){o.move.call(v,t)}),window.addEventListener(r,function(t){o.resize.call(v,t)}),g.addEventListener(u,function(t){o.cancel.call(v,t)}),g.addEventListener("transitionend",function(t){console.log("transitionend")}),window.addEventListener("scroll",function(t){l()+m()>=h()-50&&(console.log("go to bottom"),v.status.loading=!0,v.opt.down.fn(f.bind(v)))}),p.css(g,"transform","translate3d(0,0,0)"),p.css(g,"position","relative",!0),p.css(g,"z-index","20",!0),this.initTemplate(),this.status={lock:!1,loading:!1},this},o.prototype.initTemplate=function(){var t;document.querySelector(".js-mdropload-up")||(t=document.createElement("div"),t.innerHTML=this.opt.up.template.none,t.className="js-mdropload-up",this.obj.parentNode.insertBefore(t,this.obj)),document.querySelector(".js-mdropload-down")||(t=document.createElement("div"),t.innerHTML=this.opt.up.template.none,t.className="js-mdropload-down",p.insertAfter(this.obj,t)),this.upObj=document.querySelector(".js-mdropload-up"),this.downObj=document.querySelector(".js-mdropload-down")},o.start=function(t){console.log("touch start"),this.offsetY=1*this.obj.css("transform").split(",")[1].replace("px","").trim(),isNaN(this.offsetY)&&(this.offsetY=0),this.status.lock=!0,this.status.loading=!1,this.obj.css("transition-duration","0s"),this.startMouse=p.mouseXY(t)},o.end=function(t){if(console.log("touch end"),this.status.lock){this.endMouse=p.mouseXY(t);var e=this.endMouse.y-this.startMouse.y;this.status.lock=!1;var o=f.bind(this);this.obj.css("transition-duration",".5s"),this.obj.css("transform","translate3d(0,"+this.opt.height+"px,0)"),e>this.opt.height?(this.upObj.innerHTML=this.opt.up.template.loading,this.status.loading=!0,this.opt.up.fn(o)):o()}},o.move=function(t){if(this.status.lock&&(console.log("touch move"),t.preventDefault(),0===l())){var e=p.mouseXY(t),o=e.y-this.startMouse.y;o>0&&o<this.opt.windowHeight&&this.obj.css("transform","translate3d(0,"+(o+this.offsetY)+"px,0)"),o>this.opt.height&&(this.upObj.innerHTML=this.opt.up.template.message)}},o.resize=function(t){},o.cancel=function(t){},n.Mdropload=function(t,e){return new o(t,e)}}).call(this,document);