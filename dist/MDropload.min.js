!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Mdropload=e()}(this,function(){"use strict";var t,e={prefix:function(){var t=window.getComputedStyle(document.documentElement,""),e=(Array.prototype.slice.call(t).join("").match(/-(moz|webkit|ms)-/)||""===t.OLink&&["","o"])[1],o="WebKit|Moz|MS|O".match(new RegExp("("+e+")","i"))[1];return{dom:o,lowercase:e,css:"-"+e+"-",js:e[0].toUpperCase()+e.substr(1)}}(),css:function(t,e,o,n){t.style[(n?"":this.prefix.css)+e]=o},mouseXY:function(t){var e,o;return t.originalEvent&&t.originalEvent.changedTouches?(e=t.originalEvent.changedTouches[0].pageX,o=t.originalEvent.changedTouches[0].pageY):t.changedTouches?(e=t.changedTouches[0].pageX,o=t.changedTouches[0].pageY):(e=t.pageX,o=t.pageY),{x:e,y:o}},insertAfter:function(t,e){var o=t.parentNode;o.lastChild==t?o.appendChild(e):o.insertBefore(e,t.nextSibling)}},o=document,n={getScrollTop:function(){var t=0,e=0;return o.body&&(t=o.body.scrollTop),o.documentElement&&(e=o.documentElement.scrollTop),t-e>0?t:e},getScrollHeight:function(){var t=0,e=0;return document.body&&(t=document.body.scrollHeight),document.documentElement&&(e=document.documentElement.scrollHeight),t-e>0?t:e},getWindowHeight:function(){var t=0;return t="CSS1Compat"===document.compatMode?document.documentElement.clientHeight:document.body.clientHeight}},s="ontouchstart"in window,i=s?"touchstart":"mousedown",c=s?"touchend":"mouseup",r=s?"touchmove":"mousemove",a=s?"orientationchange":"resize",d=s?"touchcancel":"mouseup",u={eventStart:i,eventEnd:c,eventMove:r,eventResize:a,eventcancel:d},l=window,h=void 0,p=void 0,m=function(){!this.isLock&&this.status.loading&&(this.status.loading=!1,this.obj.css("transform","translate3d(0,0,0)"),this.upObj.innerHTML=this.opt.up.template.success)};t=function(o,s){var i=null,c=this;return h=l.document,p=h.body,i=void 0==o?p:o,c.opt=s,c.opt.windowHeight=window.innerHeight/5,c.obj=i,c.obj.css=function(t,o){return 2!==arguments.length?this.style[t]:void e.css(this,t,o)},i.addEventListener(u.eventStart,function(e){t.start.call(c,e)}),i.addEventListener(u.eventEnd,function(e){t.end.call(c,e)}),i.addEventListener(u.eventMove,function(e){t.move.call(c,e)}),window.addEventListener(u.eventResize,function(e){t.resize.call(c,e)}),i.addEventListener(u.eventcancel,function(e){t.cancel.call(c,e)}),i.addEventListener("transitionend",function(t){console.log("transitionend")}),window.addEventListener("scroll",function(t){n.getScrollTop()+n.getWindowHeight()>=n.getScrollHeight()-50&&(console.log("go to bottom"),c.status.loading=!0,c.opt.down.fn(m.bind(c)))}),e.css(i,"transform","translate3d(0,0,0)"),e.css(i,"position","relative",!0),e.css(i,"z-index","20",!0),c.initTemplate(),c.status={lock:!1,loading:!1},c},t.prototype.initTemplate=function(){var t,o=this;document.querySelector(".js-mdropload-up")||(t=document.createElement("div"),t.innerHTML=o.opt.up.template.none,t.className="js-mdropload-up",this.obj.parentNode.insertBefore(t,this.obj)),document.querySelector(".js-mdropload-down")||(t=document.createElement("div"),t.innerHTML=this.opt.up.template.none,t.className="js-mdropload-down",e.insertAfter(this.obj,t)),o.upObj=document.querySelector(".js-mdropload-up"),o.downObj=document.querySelector(".js-mdropload-down")},t.start=function(t){console.log("touch start"),this.offsetY=1*this.obj.css("transform").split(",")[1].replace("px","").trim(),isNaN(this.offsetY)&&(this.offsetY=0),this.status.lock=!0,this.status.loading=!1,this.obj.css("transition-duration","0s"),this.startMouse=e.mouseXY(t)},t.end=function(t){if(console.log("touch end"),this.status.lock){this.endMouse=e.mouseXY(t);var o=this.endMouse.y-this.startMouse.y;this.obj.css("transition-duration",".5s"),o<this.opt.height?this.obj.css("transform","translate3d(0,0px,0)"):this.obj.css("transform","translate3d(0,"+this.opt.height+"px,0)"),this.status.lock=!1;var n=m.bind(this);o>this.opt.height?(this.upObj.innerHTML=this.opt.up.template.loading,this.status.loading=!0,this.opt.up.fn(n)):n()}},t.move=function(t){var o=this;if(o.status.lock&&(console.log("touch move"),t.preventDefault(),0===n.getScrollTop())){var s=e.mouseXY(t),i=s.y-o.startMouse.y;i>0&&i<o.opt.windowHeight&&this.obj.css("transform","translate3d(0,"+(i+o.offsetY)+"px,0)"),i>o.opt.height&&(o.upObj.innerHTML=o.opt.up.template.message)}},t.resize=function(t){},t.cancel=function(t){};var f=function(e,o){return new t(e,o)};return f});