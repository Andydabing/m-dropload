!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Mdropload=e()}(this,function(){"use strict";var t,e={css:function(t,e,n,o){t.style[e]=n,o||(t.style["-webkit-"+e]=n)},elementCSS:function(t,n){return 2!==arguments.length?this.style[t]:void e.css(this,t,n)},mouseXY:function(t){var e,n;return t?(t.hasOwnProperty("originalEvent")&&t.originalEvent.hasOwnProperty("changedTouches")?(e=t.originalEvent.changedTouches[0].pageX,n=t.originalEvent.changedTouches[0].pageY):t.hasOwnProperty("changedTouches")?(e=t.changedTouches[0].pageX,n=t.changedTouches[0].pageY):(e=t.pageX,n=t.pageY),{x:e,y:n}):{x:0,y:0}},insertAfter:function(t,e){var n=t.parentNode;n.lastChild==t?n.appendChild(e):n.insertBefore(e,t.nextSibling)}},n={init:function(){var t=document.createElement("style");t.innerHTML="\n        .js-mdropload{\n            z-index:1;\n            -webkit-transform: translateZ(0);   \n            transform: translateZ(0);\n            -webkit-backface-visibility: hidden;\n            backface-visibility: hidden;\n            -webkit-perspective: 1000;\n            perspective: 1000;\n        }\n        .js-mdropload-up {\n            position: absolute;\n        }\n        .js-mdropload-down{\n            transition-duration:.5s;\n            -webkit-transition-duration:.5s;\n        }\n        .js-mdropload-up{\n            opacity:0;\n            min-height:30px;\n        }\n        .js-mdropload-down{\n            height:60px;\n            line-height:60px;\n        }\n        .js-mdropload-up,.js-mdropload-down{\n            text-align: center;\n            line-height:30px;\n            width: 100%;\n        }\n        .js-mdropload-message {\n            opacity:0;\n        }\n        ",document.body.appendChild(t)}},o=function(){var t=this,e={success:function(){console.log(t.status.lock,t.status.loading),!t.status.lock&&t.status.loading&&(e.reset(),t.opt.up.template.success&&(t.upObj.innerHTML=t.opt.up.template.success),t.opt.down.template.success&&(console.log("修改文字"),t.downObj.innerHTML=t.opt.down.template.success))},reset:function(e){console.log(e),t.obj.css("transform","translate3d(0,0,0)"),t.upObj.css("opacity","0"),t.status.bottomEvent=!1,t.status.loading=!1,e>0&&t.downObj.css("opacity","0")},end:function(){t.downObj.innerHTML=t.opt.down.template.end,e.reset()}};return e},s="ontouchstart"in window,i=s?"touchstart":"mousedown",a=s?"touchend":"mouseup",c=s?"touchmove":"mousemove",d=s?"orientationchange":"resize",r=s?"touchcancel":"mouseup",l={eventStart:i,eventEnd:a,eventMove:c,eventResize:d,eventcancel:r},u=document,p={getScrollTop:function(){var t=0,e=0;return u.body&&(t=u.body.scrollTop),u.documentElement&&(e=u.documentElement.scrollTop),t-e>0?t:e},getScrollHeight:function(){var t=0,e=0;return document.body&&(t=document.body.scrollHeight),document.documentElement&&(e=document.documentElement.scrollHeight),t-e>0?t:e},getWindowHeight:function(){var t=0;return t="CSS1Compat"===document.compatMode?document.documentElement.clientHeight:document.body.clientHeight}},h={a:"addEventListener",r:"removeEventListener",jmd:"js-mdropload",jmdUp:"js-mdropload-up",jmdDown:"js-mdropload-down",tf:"transform",t3d:"translate3d",td:"transition-duration",te:"transitionend",scroll:"scroll",o:"opacity"},m=function(t){if(!this.status.lock){var n=this.obj.getBoundingClientRect().top;0>n||n>window.innerHeight||(this.offsetY=1*this.obj.css(h.tf).split(",")[1].replace("px","").trim(),isNaN(this.offsetY)&&(this.offsetY=0),this.status.lock=!0,this.obj.css(h.td,"0s"),this.upObj.css(h.td,"0s"),this.downObj.css(h.o,"1"),this.startMouse=e.mouseXY(t),this.upObj.innerHTML=this.opt.up.template.none)}},f=null,b=function(){var t=this;t.status.loading||t.status.bottomEvent||(clearTimeout(f),f=setTimeout(function(){p.getScrollTop()+p.getWindowHeight()>=p.getScrollHeight()-50?(console.log("执行down"),t.status.loading=!0,t.status.bottomEvent=!0,t.downObj.css(h.o,"1",!1),t.downObj.innerHTML=t.opt.down.template.loading,t.opt.down&&t.opt.down.fn(o.call(t))):console.log("不执行down")},100))},j=function(t){if(this.status.lock){this.endMouse=e.mouseXY(t);var n=this.endMouse.y-this.startMouse.y;n>20&&t&&t.preventDefault&&t.preventDefault(),this.obj.css(h.td,".5s"),n<this.opt.height?this.obj.css(h.tf,h.t3d+"(0,0px,0)"):this.obj.css(h.tf,h.t3d+"(0,"+this.opt.height+"px,0)"),this.upObj.css(h.tf,h.t3d+"(0,0,0)"),this.upObj.css(h.td,this.opt.animationTime+"s"),this.status.lock=!1;var s=o.call(this);n>this.opt.height?(this.upObj.innerHTML=this.opt.up.template.loading,this.status.loading=!0,this.opt.up&&this.opt.up.fn(s)):s.reset(n)}},g=function(t){var n=this,o=window.innerHeight;if(n.status.lock){var s=e.mouseXY(t),i=s.y-n.startMouse.y;if(0===p.getScrollTop()&&i>0){if(t.preventDefault(),i>0&&i<n.opt.windowHeight){var a=(i+n.offsetY)/2,c=(a/n.opt.height).toFixed(2);c=c>1?1:c,n.obj.css(h.tf,h.t3d+"(0,"+a+"px,0)"),n.upObj.css(h.o,c);var d=(a-n.opt.height)/2;n.upObj.css(h.tf,h.t3d+"(0,"+(0>d?0:d)+"px,0)")}i>n.opt.height&&(n.upObj.innerHTML=n.opt.up.template.message)}s.y>o-100&&j.apply(n,t)}},w=function(){o.call(this).reset()},v=window,y=void 0,O=void 0;t=function(t,n){function s(t){m.call(p,t)}function i(t){j.call(p,t)}function a(t){g.call(p,t)}function c(t){w.call(p,t)}function d(){}function r(t){b.call(p,t)}var u=null,p=this;return y=v.document,O=y.body,u=void 0==t?O:t,p.opt=n,p.opt.animationTime=p.opt.animationTime||.5,p.opt.windowHeight=window.innerHeight,p.obj=u,p.obj.css=function(t,n){return 2!==arguments.length?this.style[t]:void e.css(this,t,n)},p.opt.up||(p.opt.up={isNull:!0,template:{},fn:function(){}}),p.opt.down||(p.opt.down={isNull:!0,template:{},fn:function(){}}),u[h.a](l.eventStart,s),u[h.a](l.eventEnd,i),u[h.a](l.eventMove,a),u[h.a](l.eventcancel,c),window[h.a](l.eventEnd,c),u[h.a](h.te,d),window[h.a](h.scroll,r.bind(p)),p.destroy=function(){o.call(p).reset(),u[h.r](l.eventStart,s),u[h.r](l.eventEnd,i),u[h.r](l.eventMove,a),u[h.r](l.eventcancel,c),u[h.r](h.te,d),u.classList.remove(h.jmd),window[h.r](h.scroll,r),window[h.r](l.eventcancel,c);try{p.upObj&&p.obj.parentNode.removeChild(p.upObj),p.downObj&&p.obj.parentNode.removeChild(p.downObj)}catch(t){console.warn(t)}},e.css(u,h.tf,h.t3d+"(0,0,0)"),e.css(u,"position","relative",!0),e.css(u,"z-index","20",!0),e.css(u,h.td,p.opt.animationTime),p.initTemplate(),p.status={lock:!1,loading:!1},p},t.prototype.cancel=function(){o.call(this).reset()},t.prototype.initTemplate=function(){var t,n=this;n.opt.up.isNull||document.querySelector("."+h.jmdUp)||(t=document.createElement("div"),t.innerHTML=n.opt.up.template.none,t.className=h.jmdUp,this.obj.parentNode.insertBefore(t,this.obj)),this.opt.down.isNull||this.obj.parentNode.querySelector("."+h.jmdDown)||(t=document.createElement("div"),t.innerHTML=this.opt.down.template.none,t.className=h.jmdDown,e.insertAfter(this.obj,t)),n.upObj=this.obj.parentNode.querySelector("."+h.jmdUp),n.downObj=this.obj.parentNode.querySelector("."+h.jmdDown),n.upObj?n.upObj.css=e.elementCSS.bind(n.upObj):(n.upObj={},n.upObj.css=function(){}),n.downObj?n.downObj.css=e.elementCSS.bind(n.downObj):(n.downObj={},n.downObj.css=function(){})};var T=function(e,o){if(n.init(),e instanceof Element||(e=document.querySelector(e)),null===e)throw"1001:无法寻找到可设置的html节点,请确认后再次调用.";e.classList.add(h.jmd);var s=new t(e,o);return s};return T});
//# sourceMappingURL=../dist/Mdropload.min.js.map