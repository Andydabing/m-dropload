!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Mdropload=e()}(this,function(){"use strict";var t,e={prefix:function(){var t=window.getComputedStyle(document.documentElement,""),e=(Array.prototype.slice.call(t).join("").match(/-(moz|webkit|ms)-/)||""===t.OLink&&["","o"])[1],n="WebKit|Moz|MS|O".match(new RegExp("("+e+")","i"))[1];return{dom:n,lowercase:e,css:"-"+e+"-",js:e[0].toUpperCase()+e.substr(1)}}(),css:function(t,e,n,o){t.style[e]=n,o||(t.style[this.prefix.css+e]=n)},elementCSS:function(t,n){return 2!==arguments.length?this.style[t]:void e.css(this,t,n)},mouseXY:function(t){var e,n;return t.originalEvent&&t.originalEvent.changedTouches?(e=t.originalEvent.changedTouches[0].pageX,n=t.originalEvent.changedTouches[0].pageY):t.changedTouches?(e=t.changedTouches[0].pageX,n=t.changedTouches[0].pageY):(e=t.pageX,n=t.pageY),{x:e,y:n}},insertAfter:function(t,e){var n=t.parentNode;n.lastChild==t?n.appendChild(e):n.insertBefore(e,t.nextSibling)}},n={init:function(){var t=document.createElement("style");t.innerHTML="\n        .js-mdropload{\n            z-index:1;\n            -webkit-transform: translateZ(0);   \n            transform: translateZ(0);\n            -webkit-backface-visibility: hidden;\n            backface-visibility: hidden;\n            -webkit-perspective: 1000;\n            perspective: 1000;\n        }\n        .js-mdropload-up {\n            position: absolute;\n        }\n        .js-mdropload-down{\n            transition-duration:.5s;\n            -webkit-transition-duration:.5s;\n        }\n        .js-mdropload-up,.js-mdropload-down{\n            opacity:0;\n            text-align: center;\n            height:30px;\n            line-height:30px;\n            width: 100%;\n        }\n        .js-mdropload-message {\n            opacity:0;\n        }\n        ",document.body.appendChild(t)}},o=function(){var t=this,e={success:function(){!t.isLock&&t.status.loading&&(console.log("success"),e.reset(),t.upObj.innerHTML=t.opt.up.template.success,t.downObj.innerHTML=t.opt.down.template.success)},reset:function(e){t.status.loading=!1,t.obj.css("transform","translate3d(0,0,0)"),t.upObj.css("opacity","0"),e<=0&&t.downObj.css("opacity","0")}};return e},s="ontouchstart"in window,i=s?"touchstart":"mousedown",r=s?"touchend":"mouseup",a=s?"touchmove":"mousemove",d=s?"orientationchange":"resize",c=s?"touchcancel":"mouseup",l={eventStart:i,eventEnd:r,eventMove:a,eventResize:d,eventcancel:c},u=document,p={getScrollTop:function(){var t=0,e=0;return u.body&&(t=u.body.scrollTop),u.documentElement&&(e=u.documentElement.scrollTop),t-e>0?t:e},getScrollHeight:function(){var t=0,e=0;return document.body&&(t=document.body.scrollHeight),document.documentElement&&(e=document.documentElement.scrollHeight),t-e>0?t:e},getWindowHeight:function(){var t=0;return t="CSS1Compat"===document.compatMode?document.documentElement.clientHeight:document.body.clientHeight}},m=window,h=void 0,v=void 0;t=function(n,s){function i(e){t.start.call(g,e)}function r(e){t.end.call(g,e)}function a(e){t.move.call(g,e)}function d(e){t.resize.call(g,e)}function c(e){t.cancel.call(g,e)}function u(t){}function f(t){g.status.loading||p.getScrollTop()+p.getWindowHeight()>=p.getScrollHeight()-50&&(g.status.loading=!0,g.downObj.css("opacity","1",!1),g.downObj.innerHTML=g.opt.down.template.loading,g.opt.down&&g.opt.down.fn(o.call(g)))}var b=null,g=this;return h=m.document,v=h.body,b=void 0==n?v:n,g.opt=s,g.opt.animationTime=g.opt.animationTime||.5,g.opt.windowHeight=window.innerHeight,g.obj=b,g.obj.css=function(t,n){return 2!==arguments.length?this.style[t]:void e.css(this,t,n)},b.addEventListener(l.eventStart,i),b.addEventListener(l.eventEnd,r),b.addEventListener(l.eventMove,a),window.addEventListener(l.eventResize,d),b.addEventListener(l.eventcancel,c),b.addEventListener("transitionend",u),window.addEventListener("scroll",f),g.destroy=function(){o.call(g).reset(),b.removeEventListener(l.eventStart,i),b.removeEventListener(l.eventEnd,r),b.removeEventListener(l.eventMove,a),b.removeEventListener(l.eventcancel,c),b.removeEventListener("transitionend",u),b.classList.remove("js-mdropload"),window.removeEventListener(l.eventResize,d),window.removeEventListener("scroll",f);try{g.upObj&&g.obj.parentNode.removeChild(g.upObj),g.downObj&&g.obj.parentNode.removeChild(g.downObj)}catch(t){console.warn(t)}},e.css(b,"transform","translate3d(0,0,0)"),e.css(b,"position","relative",!0),e.css(b,"z-index","20",!0),e.css(b,"transition-duration",g.opt.animationTime),g.initTemplate(),g.status={lock:!1,loading:!1},g},t.prototype.initTemplate=function(){var t,n=this;document.querySelector(".js-mdropload-up")||(t=document.createElement("div"),t.innerHTML=n.opt.up.template.none,t.className="js-mdropload-up",this.obj.parentNode.insertBefore(t,this.obj)),this.obj.parentNode.querySelector(".js-mdropload-down")||(t=document.createElement("div"),t.innerHTML=this.opt.down.template.none,t.className="js-mdropload-down",e.insertAfter(this.obj,t)),n.upObj=this.obj.parentNode.querySelector(".js-mdropload-up"),n.downObj=this.obj.parentNode.querySelector(".js-mdropload-down"),n.upObj.css=e.elementCSS.bind(n.upObj),n.downObj.css=e.elementCSS.bind(n.downObj)},t.start=function(t){this.status.lock||(this.offsetY=1*this.obj.css("transform").split(",")[1].replace("px","").trim(),isNaN(this.offsetY)&&(this.offsetY=0),this.status.lock=!0,this.status.loading=!1,this.obj.css("transition-duration","0s"),this.upObj.css("transition-duration","0s"),this.downObj.css("opacity","1"),this.startMouse=e.mouseXY(t),this.upObj.innerHTML=this.opt.up.template.none,this.downObj.innerHTML=this.opt.down.template.none)},t.end=function(t){if(this.status.lock){t.stopPropagation(),this.endMouse=e.mouseXY(t);var n=this.endMouse.y-this.startMouse.y;this.obj.css("transition-duration",".5s"),n<this.opt.height?this.obj.css("transform","translate3d(0,0px,0)"):this.obj.css("transform","translate3d(0,"+this.opt.height+"px,0)"),this.upObj.css("transform","translate3d(0,0,0)"),this.upObj.css("transition-duration",this.opt.animationTime+"s"),this.status.lock=!1;var s=o.call(this);n>this.opt.height?(this.upObj.innerHTML=this.opt.up.template.loading,this.status.loading=!0,this.opt.up&&this.opt.up.fn(s)):s.reset(n)}},t.move=function(t){var n=this;if(n.status.lock){var o=e.mouseXY(t),s=o.y-n.startMouse.y;if(0===p.getScrollTop()&&s>0){if(console.log("move"),t.preventDefault(),s>0&&s<n.opt.windowHeight){var i=(s+n.offsetY)/2,r=(i/n.opt.height).toFixed(2);r=r>1?1:r,n.obj.css("transform","translate3d(0,"+i+"px,0)"),n.upObj.css("opacity",r);var a=(i-n.opt.height)/2;n.upObj.css("transform","translate3d(0,"+(a<0?0:a)+"px,0)")}s>n.opt.height&&(n.upObj.innerHTML=n.opt.up.template.message)}}},t.resize=function(t){},t.cancel=function(t){o.call(this).reset()};var f=function(e,o){if(n.init(),e instanceof Element||(e=document.querySelector(e)),null===e)throw"1001:无法寻找到可设置的html节点,请确认后再次调用.";return e.classList.add("js-mdropload"),new t(e,o)};return f});
//# sourceMappingURL=../dist/Mdropload.min.js.map