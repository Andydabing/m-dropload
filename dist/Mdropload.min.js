!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("touchend")):"function"==typeof define&&define.amd?define(["touchend"],e):t.Mdropload=e(t.touchend)}(this,function(t){"use strict";t="default"in t?t.default:t;var e,n={css:function(t,e,n,o){t.style[e]=n,o||(t.style["-webkit-"+e]=n)},elementCSS:function(t,e){return 2!==arguments.length?this.style[t]:void n.css(this,t,e)},mouseXY:function(t){var e,n;return t.originalEvent&&t.originalEvent.changedTouches?(e=t.originalEvent.changedTouches[0].pageX,n=t.originalEvent.changedTouches[0].pageY):t.changedTouches?(e=t.changedTouches[0].pageX,n=t.changedTouches[0].pageY):(e=t.pageX,n=t.pageY),{x:e,y:n}},insertAfter:function(t,e){var n=t.parentNode;n.lastChild==t?n.appendChild(e):n.insertBefore(e,t.nextSibling)}},o={init:function(){var t=document.createElement("style");t.innerHTML="\n        .js-mdropload{\n            z-index:1;\n            -webkit-transform: translateZ(0);   \n            transform: translateZ(0);\n            -webkit-backface-visibility: hidden;\n            backface-visibility: hidden;\n            -webkit-perspective: 1000;\n            perspective: 1000;\n        }\n        .js-mdropload-up {\n            position: absolute;\n        }\n        .js-mdropload-down{\n            transition-duration:.5s;\n            -webkit-transition-duration:.5s;\n        }\n        .js-mdropload-up{\n            opacity:0;\n            min-height:30px;\n        }\n        .js-mdropload-down{\n            height:60px;\n            line-height:60px;\n        }\n        .js-mdropload-up,.js-mdropload-down{\n            text-align: center;\n            line-height:30px;\n            width: 100%;\n        }\n        .js-mdropload-message {\n            opacity:0;\n        }\n        ",document.body.appendChild(t)}},s=function(){var t=this,e={success:function(){console.log(t.status.lock,t.status.loading),!t.status.lock&&t.status.loading&&(e.reset(),t.opt.up.template.success&&(t.upObj.innerHTML=t.opt.up.template.success),t.opt.down.template.success&&(console.log("修改文字"),t.downObj.innerHTML=t.opt.up.template.success))},reset:function(e){console.log(e),t.obj.css("transform","translate3d(0,0,0)"),t.upObj.css("opacity","0"),t.status.bottomEvent=!1,t.status.loading=!1,e>0&&t.downObj.css("opacity","0")},end:function(){t.downObj.innerHTML=t.opt.down.template.end,e.reset()}};return e},i="ontouchstart"in window,a=i?"touchstart":"mousedown",c=i?"touchend":"mouseup",d=i?"touchmove":"mousemove",l=i?"orientationchange":"resize",r=i?"touchcancel":"mouseup",u={eventStart:a,eventEnd:c,eventMove:d,eventResize:l,eventcancel:r},p=document,h={getScrollTop:function(){var t=0,e=0;return p.body&&(t=p.body.scrollTop),p.documentElement&&(e=p.documentElement.scrollTop),t-e>0?t:e},getScrollHeight:function(){var t=0,e=0;return document.body&&(t=document.body.scrollHeight),document.documentElement&&(e=document.documentElement.scrollHeight),t-e>0?t:e},getWindowHeight:function(){var t=0;return t="CSS1Compat"===document.compatMode?document.documentElement.clientHeight:document.body.clientHeight}},m={a:"addEventListener",r:"removeEventListener",jmd:"js-mdropload",jmdUp:"js-mdropload-up",jmdDown:"js-mdropload-down",tf:"transform",t3d:"translate3d",td:"transition-duration",te:"transitionend",scroll:"scroll",o:"opacity"},f=function(t){this.status.lock||(this.offsetY=1*this.obj.css(m.tf).split(",")[1].replace("px","").trim(),isNaN(this.offsetY)&&(this.offsetY=0),this.status.lock=!0,this.obj.css(m.td,"0s"),this.upObj.css(m.td,"0s"),this.downObj.css(m.o,"1"),this.startMouse=n.mouseXY(t),this.upObj.innerHTML=this.opt.up.template.none)},b=null,j=function(t){var e=this;e.status.loading||e.status.bottomEvent||(clearTimeout(b),b=setTimeout(function(){h.getScrollTop()+h.getWindowHeight()>=h.getScrollHeight()-50?(console.log("执行down"),e.status.loading=!0,e.status.bottomEvent=!0,e.downObj.css(m.o,"1",!1),e.downObj.innerHTML=e.opt.down.template.loading,e.opt.down&&e.opt.down.fn(s.call(e))):console.log("不执行down")},100))},g=function(t){if(this.status.lock){t.stopPropagation(),this.endMouse=n.mouseXY(t);var e=this.endMouse.y-this.startMouse.y;this.obj.css(m.td,".5s"),e<this.opt.height?this.obj.css(m.tf,m.t3d+"(0,0px,0)"):this.obj.css(m.tf,m.t3d+"(0,"+this.opt.height+"px,0)"),this.upObj.css(m.tf,m.t3d+"(0,0,0)"),this.upObj.css(m.td,this.opt.animationTime+"s"),this.status.lock=!1;var o=s.call(this);e>this.opt.height?(this.upObj.innerHTML=this.opt.up.template.loading,this.status.loading=!0,this.opt.up&&this.opt.up.fn(o)):o.reset(e)}},v=function(e){var o=this,s=window.innerHeight;if(o.status.lock){var i=n.mouseXY(e),a=i.y-o.startMouse.y;if(0===h.getScrollTop()&&a>0){if(e.preventDefault(),a>0&&a<o.opt.windowHeight){var c=(a+o.offsetY)/2,d=(c/o.opt.height).toFixed(2);d=d>1?1:d,o.obj.css(m.tf,m.t3d+"(0,"+c+"px,0)"),o.upObj.css(m.o,d);var l=(c-o.opt.height)/2;o.upObj.css(m.tf,m.t3d+"(0,"+(l<0?0:l)+"px,0)")}a>o.opt.height&&(o.upObj.innerHTML=o.opt.up.template.message)}i.y>s-100&&t.apply(o,e)}},w=function(t){s.call(this).reset()},y=window,O=void 0,T=void 0;e=function(t,e){function o(t){f.call(p,t)}function i(t){g.call(p,t)}function a(t){v.call(p,t)}function c(t){w.call(p,t)}function d(t){}function l(t){j.call(p,t)}var r=null,p=this;return O=y.document,T=O.body,r=void 0==t?T:t,p.opt=e,p.opt.animationTime=p.opt.animationTime||.5,p.opt.windowHeight=window.innerHeight,p.obj=r,p.obj.css=function(t,e){return 2!==arguments.length?this.style[t]:void n.css(this,t,e)},p.opt.up||(p.opt.up={isNull:!0,template:{},fn:function(){}}),p.opt.down||(p.opt.down={isNull:!0,template:{},fn:function(){}}),r[m.a](u.eventStart,o),r[m.a](u.eventEnd,i),r[m.a](u.eventMove,a),r[m.a](u.eventcancel,c),window[m.a](u.eventEnd,c),r[m.a](m.te,d),window[m.a](m.scroll,l.bind(p)),p.destroy=function(){s.call(p).reset(),r[m.r](u.eventStart,o),r[m.r](u.eventEnd,i),r[m.r](u.eventMove,a),r[m.r](u.eventcancel,c),r[m.r](m.te,d),r.classList.remove(m.jmd),window[m.r](m.scroll,l),window[m.r](u.eventcancel,c);try{p.upObj&&p.obj.parentNode.removeChild(p.upObj),p.downObj&&p.obj.parentNode.removeChild(p.downObj)}catch(t){console.warn(t)}},n.css(r,m.tf,m.t3d+"(0,0,0)"),n.css(r,"position","relative",!0),n.css(r,"z-index","20",!0),n.css(r,m.td,p.opt.animationTime),p.initTemplate(),p.status={lock:!1,loading:!1},p},e.prototype.cancel=function(){s.call(this).reset()},e.prototype.initTemplate=function(){var t,e=this;e.opt.up.isNull||document.querySelector("."+m.jmdUp)||(t=document.createElement("div"),t.innerHTML=e.opt.up.template.none,t.className=m.jmdUp,this.obj.parentNode.insertBefore(t,this.obj)),this.opt.down.isNull||this.obj.parentNode.querySelector("."+m.jmdDown)||(t=document.createElement("div"),t.innerHTML=this.opt.down.template.none,t.className=m.jmdDown,n.insertAfter(this.obj,t)),e.upObj=this.obj.parentNode.querySelector("."+m.jmdUp),e.downObj=this.obj.parentNode.querySelector("."+m.jmdDown),e.upObj?e.upObj.css=n.elementCSS.bind(e.upObj):(e.upObj={},e.upObj.css=function(){}),e.downObj?e.downObj.css=n.elementCSS.bind(e.downObj):(e.downObj={},e.downObj.css=function(){})};var E=function(t,n){if(o.init(),t instanceof Element||(t=document.querySelector(t)),null===t)throw"1001:无法寻找到可设置的html节点,请确认后再次调用.";t.classList.add(m.jmd);var s=new e(t,n);return s};return E});
//# sourceMappingURL=../dist/Mdropload.min.js.map