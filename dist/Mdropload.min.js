!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Mdropload=t()}(this,function(){"use strict";var e,t={prefix:function(){var e=window.getComputedStyle(document.documentElement,""),t=(Array.prototype.slice.call(e).join("").match(/-(moz|webkit|ms)-/)||""===e.OLink&&["","o"])[1],n="WebKit|Moz|MS|O".match(new RegExp("("+t+")","i"))[1];return{dom:n,lowercase:t,css:"-"+t+"-",js:t[0].toUpperCase()+t.substr(1)}}(),css:function(e,t,n,o){e.style[t]=n,o||(e.style[this.prefix.css+t]=n)},elementCSS:function(e,n){return 2!==arguments.length?this.style[e]:void t.css(this,e,n)},mouseXY:function(e){var t,n;return e.originalEvent&&e.originalEvent.changedTouches?(t=e.originalEvent.changedTouches[0].pageX,n=e.originalEvent.changedTouches[0].pageY):e.changedTouches?(t=e.changedTouches[0].pageX,n=e.changedTouches[0].pageY):(t=e.pageX,n=e.pageY),{x:t,y:n}},insertAfter:function(e,t){var n=e.parentNode;n.lastChild==e?n.appendChild(t):n.insertBefore(t,e.nextSibling)}},n={init:function(){var e=document.createElement("style");e.innerHTML="\n        .js-mdropload{\n            z-index:1;\n            -webkit-transform: translateZ(0);   \n            transform: translateZ(0);\n            -webkit-backface-visibility: hidden;\n            backface-visibility: hidden;\n            -webkit-perspective: 1000;\n            perspective: 1000;\n        }\n        .js-mdropload-up {\n            position: absolute;\n            text-align: center;\n            height:30px;\n            line-height:30px;\n            width: 100%;\n            opacity:0;\n            transition-duration: .5s;\n        }\n        .js-mdropload-message {\n            opacity:0;\n        }\n        ",document.body.appendChild(e)}},o=function(){var e=this,t={success:function(){!e.isLock&&e.status.loading&&(console.log("success"),t.reset(),e.upObj.innerHTML=e.opt.up.template.success,e.downObj.innerHTML=e.opt.down.template.success)},reset:function(){console.log("reset"),e.status.loading=!1,e.obj.css("transform","translate3d(0,0,0)"),e.upObj.css("opacity","0")}};return t},s="ontouchstart"in window,i=s?"touchstart":"mousedown",r=s?"touchend":"mouseup",a=s?"touchmove":"mousemove",c=s?"orientationchange":"resize",d=s?"touchcancel":"mouseup",l={eventStart:i,eventEnd:r,eventMove:a,eventResize:c,eventcancel:d},u=document,p={getScrollTop:function(){var e=0,t=0;return u.body&&(e=u.body.scrollTop),u.documentElement&&(t=u.documentElement.scrollTop),e-t>0?e:t},getScrollHeight:function(){var e=0,t=0;return document.body&&(e=document.body.scrollHeight),document.documentElement&&(t=document.documentElement.scrollHeight),e-t>0?e:t},getWindowHeight:function(){var e=0;return e="CSS1Compat"===document.compatMode?document.documentElement.clientHeight:document.body.clientHeight}},m=window,h=void 0,v=void 0;e=function(n,s){function i(t){e.start.call(b,t)}function r(t){e.end.call(b,t)}function a(t){e.move.call(b,t)}function c(t){e.resize.call(b,t)}function d(t){e.cancel.call(b,t)}function u(e){console.log("transitionend")}function f(e){b.status.loading||p.getScrollTop()+p.getWindowHeight()>=p.getScrollHeight()&&(console.log("go to bottom"),b.status.loading=!0,b.opt.down.fn(o.call(b)))}var g=null,b=this;return h=m.document,v=h.body,g=void 0==n?v:n,b.opt=s,b.opt.animationTime=b.opt.animationTime||.5,b.opt.windowHeight=window.innerHeight/5,b.obj=g,b.obj.css=function(e,n){return 2!==arguments.length?this.style[e]:void t.css(this,e,n)},g.addEventListener(l.eventStart,i),g.addEventListener(l.eventEnd,r),g.addEventListener(l.eventMove,a),window.addEventListener(l.eventResize,c),g.addEventListener(l.eventcancel,d),g.addEventListener("transitionend",u),window.addEventListener("scroll",f),b.destroy=function(){console.log("load destroy"),o.call(b).reset(),g.removeEventListener(l.eventStart,i),g.removeEventListener(l.eventEnd,r),g.removeEventListener(l.eventMove,a),g.removeEventListener(l.eventcancel,d),g.removeEventListener("transitionend",u),g.classList.remove("js-mdropload"),window.removeEventListener(l.eventResize,c),window.removeEventListener("scroll",f),b.upObj&&document.body.removeChild(b.upObj),b.downObj&&document.body.removeChild(b.downObj)},t.css(g,"transform","translate3d(0,0,0)"),t.css(g,"position","relative",!0),t.css(g,"z-index","20",!0),t.css(g,"transition-duration",b.opt.animationTime),b.initTemplate(),b.status={lock:!1,loading:!1},b},e.prototype.initTemplate=function(){var e,n=this;document.querySelector(".js-mdropload-up")||(e=document.createElement("div"),e.innerHTML=n.opt.up.template.none,e.className="js-mdropload-up",this.obj.parentNode.insertBefore(e,this.obj)),document.querySelector(".js-mdropload-down")||(e=document.createElement("div"),e.innerHTML=this.opt.up.template.none,e.className="js-mdropload-down",t.insertAfter(this.obj,e)),n.upObj=document.querySelector(".js-mdropload-up"),n.downObj=document.querySelector(".js-mdropload-down"),n.upObj.css=t.elementCSS.bind(n.upObj),n.downObj.css=t.elementCSS.bind(n.downObj)},e.start=function(e){this.status.lock||(console.log("touch start"),e.preventDefault(),this.offsetY=1*this.obj.css("transform").split(",")[1].replace("px","").trim(),isNaN(this.offsetY)&&(this.offsetY=0),this.status.lock=!0,this.status.loading=!1,this.obj.css("transition-duration","0s"),this.startMouse=t.mouseXY(e),this.upObj.innerHTML=this.opt.up.template.none,this.downObj.innerHTML=this.opt.down.template.none)},e.end=function(e){if(this.status.lock){e.stopPropagation(),this.endMouse=t.mouseXY(e);var n=this.endMouse.y-this.startMouse.y;this.obj.css("transition-duration",".5s"),n<this.opt.height?this.obj.css("transform","translate3d(0,0px,0)"):this.obj.css("transform","translate3d(0,"+this.opt.height+"px,0)"),this.status.lock=!1;var s=o.call(this);n>this.opt.height?(this.upObj.innerHTML=this.opt.up.template.loading,this.status.loading=!0,this.opt.up.fn(s)):s.reset()}},e.move=function(e){var n=this;if(n.status.lock){var o=t.mouseXY(e),s=o.y-n.startMouse.y;if(0===p.getScrollTop()&&s>0){if(e.preventDefault(),s>0&&s<n.opt.windowHeight){var i=s+n.offsetY,r=(i/n.opt.height).toFixed(2);r=r>1?1:r,n.obj.css("transform","translate3d(0,"+i+"px,0)"),n.upObj.css("opacity",r)}s>n.opt.height&&(n.upObj.innerHTML=n.opt.up.template.message)}}},e.resize=function(e){},e.cancel=function(e){o.call(this).reset()};var f=function(t,o){if(n.init(),t instanceof Element||(t=document.querySelector(t)),null===t)throw"1001:无法寻找到可设置的html节点,请确认后再次调用.";return t.classList.add("js-mdropload"),new e(t,o)};return f});
//# sourceMappingURL=../dist/Mdropload.min.js.map