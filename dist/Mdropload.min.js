!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Mdropload=e()}(this,function(){"use strict";var t,e={css:function(t,e,n,o){t.style[e]=n,o||(t.style["-webkit-"+e]=n)},elementCSS:function(t,n){return 2!==arguments.length?this.style[t]:void e.css(this,t,n)},mouseXY:function(t){var e,n;return t.originalEvent&&t.originalEvent.changedTouches?(e=t.originalEvent.changedTouches[0].pageX,n=t.originalEvent.changedTouches[0].pageY):t.changedTouches?(e=t.changedTouches[0].pageX,n=t.changedTouches[0].pageY):(e=t.pageX,n=t.pageY),{x:e,y:n}},insertAfter:function(t,e){var n=t.parentNode;n.lastChild==t?n.appendChild(e):n.insertBefore(e,t.nextSibling)}},n={init:function(){var t=document.createElement("style");t.innerHTML="\n        .js-mdropload{\n            z-index:1;\n            -webkit-transform: translateZ(0);   \n            transform: translateZ(0);\n            -webkit-backface-visibility: hidden;\n            backface-visibility: hidden;\n            -webkit-perspective: 1000;\n            perspective: 1000;\n        }\n        .js-mdropload-up {\n            position: absolute;\n        }\n        .js-mdropload-down{\n            transition-duration:.5s;\n            -webkit-transition-duration:.5s;\n        }\n        .js-mdropload-up{\n            opacity:0;\n            min-height:30px;\n        }\n        .js-mdropload-down{\n            height:60px;\n            line-height:60px;\n        }\n        .js-mdropload-up,.js-mdropload-down{\n            text-align: center;\n            line-height:30px;\n            width: 100%;\n        }\n        .js-mdropload-message {\n            opacity:0;\n        }\n        ",document.body.appendChild(t)}},o=function(){var t=this,e={success:function(){!t.isLock&&t.status.loading&&(e.reset(),t.opt.up.template.success&&(t.upObj.innerHTML=t.opt.up.template.success),t.opt.down.template.success&&(t.downObj.innerHTML=t.opt.up.template.success))},reset:function(e){t.status.loading=!1,t.obj.css("transform","translate3d(0,0,0)"),t.upObj.css("opacity","0"),e>0&&t.downObj.css("opacity","0")},end:function(){t.downObj.innerHTML=t.opt.down.template.end,e.reset()}};return e},s="ontouchstart"in window,i=s?"touchstart":"mousedown",a=s?"touchend":"mouseup",d=s?"touchmove":"mousemove",c=s?"orientationchange":"resize",r=s?"touchcancel":"mouseup",l={eventStart:i,eventEnd:a,eventMove:d,eventResize:c,eventcancel:r},u=document,p={getScrollTop:function(){var t=0,e=0;return u.body&&(t=u.body.scrollTop),u.documentElement&&(e=u.documentElement.scrollTop),t-e>0?t:e},getScrollHeight:function(){var t=0,e=0;return document.body&&(t=document.body.scrollHeight),document.documentElement&&(e=document.documentElement.scrollHeight),t-e>0?t:e},getWindowHeight:function(){var t=0;return t="CSS1Compat"===document.compatMode?document.documentElement.clientHeight:document.body.clientHeight}},h={a:"addEventListener",r:"removeEventListener",jmd:"js-mdropload",jmdUp:"js-mdropload-up",jmdDown:"js-mdropload-down",tf:"transform",t3d:"translate3d",td:"transition-duration",te:"transitionend",scroll:"scroll",o:"opacity"},m=window,f=void 0,j=void 0;t=function(n,s){function i(e){t.start.call(w,e)}function a(e){t.end.call(w,e)}function d(e){t.move.call(w,e)}function c(e){t.resize.call(w,e)}function r(e){t.cancel.call(w,e)}function u(t){}function b(t){var e=this;e.status.loading||p.getScrollTop()+p.getWindowHeight()>=p.getScrollHeight()-50&&(e.status.loading=!0,e.downObj.css(h.o,"1",!1),e.downObj.innerHTML=e.opt.down.template.loading,e.opt.down&&e.opt.down.fn(o.call(e)))}var v=null,w=this;return f=m.document,j=f.body,v=void 0==n?j:n,w.opt=s,w.opt.animationTime=w.opt.animationTime||.5,w.opt.windowHeight=window.innerHeight,w.obj=v,w.obj.css=function(t,n){return 2!==arguments.length?this.style[t]:void e.css(this,t,n)},w.opt.up||(w.opt.up={isNull:!0,template:{},fn:function(){}}),w.opt.down||(w.opt.down={isNull:!0,template:{},fn:function(){}}),v[h.a](l.eventStart,i),v[h.a](l.eventEnd,a),v[h.a](l.eventMove,d),window[h.a](l.eventResize,c),v[h.a](l.eventcancel,r),v[h.a](h.te,u),window[h.a](h.scroll,b.bind(w)),w.destroy=function(){o.call(w).reset(),v[h.r](l.eventStart,i),v[h.r](l.eventEnd,a),v[h.r](l.eventMove,d),v[h.r](l.eventcancel,r),v[h.r](h.te,u),v.classList.remove(h.jmd),window[h.r](l.eventResize,c),window[h.r](h.scroll,b);try{w.upObj&&w.obj.parentNode.removeChild(w.upObj),w.downObj&&w.obj.parentNode.removeChild(w.downObj)}catch(t){console.warn(t)}},e.css(v,h.tf,h.t3d+"(0,0,0)"),e.css(v,"position","relative",!0),e.css(v,"z-index","20",!0),e.css(v,h.td,w.opt.animationTime),w.initTemplate(),w.status={lock:!1,loading:!1},w},t.prototype.cancel=function(){o.call(this).reset()},t.prototype.initTemplate=function(){var t,n=this;n.opt.up.isNull||document.querySelector("."+h.jmdUp)||(t=document.createElement("div"),t.innerHTML=n.opt.up.template.none,t.className=h.jmdUp,this.obj.parentNode.insertBefore(t,this.obj)),this.opt.down.isNull||this.obj.parentNode.querySelector("."+h.jmdDown)||(t=document.createElement("div"),t.innerHTML=this.opt.down.template.none,t.className=h.jmdDown,e.insertAfter(this.obj,t)),n.upObj=this.obj.parentNode.querySelector("."+h.jmdUp),n.downObj=this.obj.parentNode.querySelector("."+h.jmdDown),n.upObj?n.upObj.css=e.elementCSS.bind(n.upObj):(n.upObj={},n.upObj.css=function(){}),n.downObj?n.downObj.css=e.elementCSS.bind(n.downObj):(n.downObj={},n.downObj.css=function(){})},t.start=function(t){this.status.lock||(this.offsetY=1*this.obj.css(h.tf).split(",")[1].replace("px","").trim(),isNaN(this.offsetY)&&(this.offsetY=0),this.status.lock=!0,this.status.loading=!1,this.obj.css(h.td,"0s"),this.upObj.css(h.td,"0s"),this.downObj.css(h.o,"1"),this.startMouse=e.mouseXY(t),this.upObj.innerHTML=this.opt.up.template.none,this.downObj.innerHTML=this.opt.down.template.none)},t.end=function(t){if(this.status.lock){t.stopPropagation(),this.endMouse=e.mouseXY(t);var n=this.endMouse.y-this.startMouse.y;this.obj.css(h.td,".5s"),n<this.opt.height?this.obj.css(h.tf,h.t3d+"(0,0px,0)"):this.obj.css(h.tf,h.t3d+"(0,"+this.opt.height+"px,0)"),this.upObj.css(h.tf,h.t3d+"(0,0,0)"),this.upObj.css(h.td,this.opt.animationTime+"s"),this.status.lock=!1;var s=o.call(this);n>this.opt.height?(this.upObj.innerHTML=this.opt.up.template.loading,this.status.loading=!0,this.opt.up&&this.opt.up.fn(s)):s.reset(n),n<=0&&(this.downObj.innerHTML=this.opt.down.template.loading)}},t.move=function(t){var n=this;if(n.status.lock){var o=e.mouseXY(t),s=o.y-n.startMouse.y;if(0===p.getScrollTop()&&s>0){if(console.log("move"),t.preventDefault(),s>0&&s<n.opt.windowHeight){var i=(s+n.offsetY)/2,a=(i/n.opt.height).toFixed(2);a=a>1?1:a,n.obj.css(h.tf,h.t3d+"(0,"+i+"px,0)"),n.upObj.css(h.o,a);var d=(i-n.opt.height)/2;n.upObj.css(h.tf,h.t3d+"(0,"+(d<0?0:d)+"px,0)")}s>n.opt.height&&(n.upObj.innerHTML=n.opt.up.template.message)}}},t.resize=function(t){},t.cancel=function(t){o.call(this).reset()};var b=function(e,o){if(n.init(),e instanceof Element||(e=document.querySelector(e)),null===e)throw"1001:无法寻找到可设置的html节点,请确认后再次调用.";e.classList.add(h.jmd);var s=new t(e,o);return s};return b});
//# sourceMappingURL=../dist/Mdropload.min.js.map